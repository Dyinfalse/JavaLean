## 网络编程

*2020-08-14 Dyinfalse* 本篇是阅读[廖雪峰文章](https://www.liaoxuefeng.com/wiki/1252599548343744/1305163149082658)的总结

#### **什么是互联网**

计算机网络是指两台或更多的计算机组成的网络，在同一个网络中，任意两个计算机都可以直接通信，因为所有计算机都需要遵循同一种网络协议。

互联网就是网络的网络（internet），即把多个计算机网络链接起来，形成一个全球统一的互联网。

对某个特定的计算机网络来说，它可能使用网络协议ABC，而另一个计算机网络可能使用网络协议XYZ，如果计算机网络各自的通信协议不统一，就没法把不同的网络链接起来形成全球统一的互联网。因此为了把计算机网络接入互联网，就必须使用TCP/IP协议。

TCP/IP学医泛指互联网协议，其中最重要的两个协议是TCP协议和IP协议，只有使用TCP/IP协议的计算机才能接入互联网，使用其他协议（例如NetBIOS，AppleTalk协议等）是无法联如互联网的。

#### **IP地址**

在互联网中，一个IP地址用与标识一个唯一的网络接口（Network Interface）。一台联入互联网的计算机肯定有一个IP地址，但也可能有多个IP地址。

IP地址分为IPv4和IPv6两种，IPv4采用32位地址，类似`101.202.99.12`，而IPv5采用128位地址，类似`2001:0DA8:100A:0000:0000:1020:F2F3:1428`，IPv4总共有2^32个大约（42亿），而IPv6总共有2^128个（大约340亿亿亿亿亿），IPv4地址目前已经耗尽，而IPv6的地址根本用不完。

IP地址又分为公网IP和内网IP，公网IP地址可以直接放完，内网IP地址只能在内网访问，内网地址类似于：

- 192.169.x.x
- 10.x.x.x

有一个特殊的IP地址，称之为本机地址，它总是`127.0.0.1`。

IPv4地址实际上是一个32位整数，例如：

```
106717964 = 0x65ca630c
          = 65  ca  63 0c
          = 101.202.99.12
```

如果计算只有一个网卡，并且接入网络，那么它有一个本机地址`127.0.0.1`，还有一个IP地址，例如`101.202.99.12`，可以通过这个IP地址接入网络。

如果一台计算机有两个网卡，那么除了本机地址，它可以有两个IP地址，可以分别接入两个网络。通常接入两个网络的设备是路由器或者交换机，它至少有两个IP地址，分别接入不同的网络，让网络之间链接起来。

如果两台计算机位于同一个网络，那么他们之间可以直接通信，因为它们的IP地址前段是相同的，也就是网络号是相同的。网络号是IP地址通过子网掩码过滤后得到的。例如：

某台计算机的IP是101.202.99.2，子网掩码是255.255.255.0，那么计算机的网络号就是：

```
IP = 101.202.99.2
Mask = 255.255.255.0
Network = IP & Mask = 101.202.99.0 
```

每台计算机都需要正确的配置IP地址和子网掩码，根据这两个就可以计算网络号，如果两个计算机计算出的网络号相同，说明两台计算机在同一个网络，可以直接通信，如果两个计算机的网络号不同，那么两台计算机不再同一个网络，不能直接通信，它们之间必须通过路由器或者交换机这样的网络设备间接通信，我们把这种设备称为网关。

网关的作用就是链接多个网络，负责把来自一个网络的数据包发到另一个网络，这个过程叫路由。

所以一台计算机的一个网卡会有三个关键配置：

```
IPv4 地址： 10.0.2.15
IPv4 子网掩码：255.255.255.0

IPv4 默认网关：10.0.2.2
```

#### **域名**

因为直接记忆IP地址非常困难，所以我们通常使用域名访问某个特定的服务，域名解析服务器DNS负责把域名翻译称对应的IP，客户端再根据IP地址访问服务器。

用nslookup可以查看对应的IP地址：

```shell script
nslookup www.baidu.com
Server: xxx.xxx.xxx.xxx
Address: xxx.xxx.xxx.xxx#53

Non-authoritative answer:
Name: www.baidu.com
Address: 47.98.33.223
```

有一个特殊的本机域名localhost，它对应的IP地址总是本机地址`127.0.0.1`。

#### **网络模型**

由于计算机网络从底层的传输到高层的软件设计十分复杂，要合理的设计计算机网络模型，必须采用分层模型，每一层处理自己的操作。OSI（Open System Interconnect）网络模型是ISO组织定义的一个计算机互联网的标准模型，注意它只是一个定义，目的是为了简化网络各层的操作，提供标准接口便于实现和维护，这个模型从上到下依次是：

- 应用层：提供应用程序之间的通信；
- 表示层：处理数据格式，加密等等；
- 会话层：负责建立和维护会话；
- 传输层：负责提供端到端的可靠传输；
- 网络层：负责根据目标地址选择路由来传输数据；
- 链路层和物理层负责把数据进行分片并且真正通过物理网络传输，例如，无线网，光纤等。

互联网实际使用的TCP/IP模型并不是对应到OSI的7层模型，而是大致对应OSI的五层模型：

|OSI|TCP/IP|
|---|---|
|应用层|应用层|
|表示层||
|会话层||
|传输层|传输层|
|网络层|IP层|
|链路层|网络接口层|
|物理层||

#### **常用协议**

IP协议是一个分组交换，它不保证可靠传输。而TCP协议是传输控制协议，它是面向链接的协议，支持可靠传输和双向通信。TCP协议是建立在IP协议之上的，简单的说，IP协议只负责发数据包，不保证顺序和正确性，而TCP协议负责控制数据包传输，它在传输数据之前需要先建立连接，建立连接之后才能传输数据，传输完成后还需要断开连接，TCP协议之所以能保证数据的可靠传输，是通过接收确认，超时重传这些机制实现的。并且，TCP协议还允许双向通信，即通信双方可以同时发送和接收数据。

TCP协议也是应用最广泛的协议，许多高级协议都是建立在TCP协议之上的，例如HTTP，SMTP等。

UDP协议（User Datagram Protocol）是一种数据保文协议，它是无连接协议，不保证可靠传输，因为UDP协议在通信前不需要建立连接，因此他的传输效率比TCP高，而且UDP协议比TCP协议要简单的多。

选择UDP协议时，传输的数据通常是能容忍丢失的，例如，一些语音视频通信的应用会选择UDP协议。




















